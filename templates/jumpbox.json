{

    "Parameters":{
        "ApplicationName":{
            "Type":"String"
        },
        "EnvironmentName":{
            "Type":"String"
        },
        "KeyName":{
            "Description":"Name of an existing EC2 KeyPair to enable SSH access to the instances",
            "Type":"AWS::EC2::KeyPair::KeyName",
            "ConstraintDescription":"must be the name of an existing EC2 KeyPair."
        },
        "InstanceType":{
            "Description":"The instance type to deploy to",
            "Type":"String",
            "Default":"t2.micro"
        }
    },
    "Mappings":{
        "AWSRegionToAMI":{
            "us-east-1":{
                "AMI":"ami-9be6f38c"
            },
            "us-east-2":{
                "AMI":"ami-38cd975d"
            },
            "us-west-1":{
                "AMI":"ami-25110f45"
            },
            "us-west-2":{
                "AMI":"ami-e251209a"
            },
            "ca-central-1":{
                "AMI":"ami-eb20928f"
            },
            "eu-west-1":{
                "AMI":"ami-c51e3eb6"
            },
            "eu-west-2":{
                "AMI":"ami-bfe0eadb"
            },
            "eu-central-1":{
                "AMI":"ami-211ada4e"
            },
            "ap-southeast-1":{
                "AMI":"ami-4dd6782e"
            },
            "ap-northeast-2":{
                "AMI":"ami-94bb6dfa"
            },
            "ap-northeast-1":{
                "AMI":"ami-9f0c67f8"
            },
            "ap-southeast-2":{
                "AMI":"ami-28cff44b"
            },
            "ap-south-1":{
                "AMI":"ami-9fc7b0f0"
            },
            "sa-east-1":{
                "AMI":"ami-bb40d8d7"
            }
        }
    },
    "Resources":{
        "JumpBox1":{
            "Type":"AWS::EC2::Instance",
            "Properties":{
                "KeyName":{
                    "Ref":"KeyName"
                },
                "Tags":[
                    {
                        "Key":"Name",
                        "Value":{
                            "Fn::Sub":"${ApplicationName} ${EnvironmentName}-Jumpbox"
                        }
                    }
                ],
                "ImageId":{
                    "Fn::FindInMap":[
                        "AWSRegionToAMI",
                        {
                            "Ref":"AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType":{
                    "Ref":"InstanceType"
                },
                "NetworkInterfaces":[
                    {
                        "DeviceIndex":"0",
                        "AssociatePublicIpAddress":"true",
                        "DeleteOnTermination":"true",
                        "SubnetId":{
                            "Fn::ImportValue":{
                                "Fn::Sub":"network-${ApplicationName}-${EnvironmentName}-PublicSubnet1"
                            }
                        },
                        "GroupSet":[
                            {
                                "Ref":"InstanceSecurityGroup"
                            }
                        ]
                    }
                ]
            }
        },
        "JumpBox2":{
            "Type":"AWS::EC2::Instance",
            "Properties":{
                "KeyName":{
                    "Ref":"KeyName"
                },
                "Tags":[
                    {
                        "Key":"Name",
                        "Value":{
                            "Fn::Sub":"${ApplicationName} ${EnvironmentName}-Jumpbox"
                        }
                    }
                ],
                "ImageId":{
                    "Fn::FindInMap":[
                        "AWSRegionToAMI",
                        {
                            "Ref":"AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType":{
                    "Ref":"InstanceType"
                },
                "NetworkInterfaces":[
                    {
                        "DeviceIndex":"0",
                        "AssociatePublicIpAddress":"true",
                        "DeleteOnTermination":"true",
                        "SubnetId":{
                            "Fn::ImportValue":{
                                "Fn::Sub":"network-${ApplicationName}-${EnvironmentName}-PublicSubnet2"
                            }
                        },
                        "GroupSet":[
                            {
                                "Ref":"InstanceSecurityGroup"
                            }
                        ]
                    }
                ]
            }
        },
        "InstanceSecurityGroup":{
            "Type":"AWS::EC2::SecurityGroup",
            "Properties":{
                "GroupDescription":"Enable HTTP access",
                "VpcId":{
                    "Fn::ImportValue":{
                        "Fn::Sub":"network-${ApplicationName}-${EnvironmentName}"
                    }
                },
                "SecurityGroupIngress":[
                    {
                        "IpProtocol":"tcp",
                        "FromPort":"22",
                        "ToPort":"22",
                        "CidrIp":"0.0.0.0/0"
                    }
                ],
                "Tags":[
                    {
                        "Key":"Name",
                        "Value":{
                            "Fn::Sub":"${ApplicationName} ${EnvironmentName}-Instance Security group"
                        }
                    }
                ]
            }
        }
    }

}
